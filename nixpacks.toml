[phases.setup]
nixPkgs = ["python311", "python311Packages.pip", "python311Packages.setuptools"]
# opencv-python-headless için minimal sistem bağımlılıkları
aptPkgs = [
    "libgl1",
    "libglib2.0-0",
    "libsm6",
    "libxext6",
    "libxrender1"
]

[phases.install]
cmds = ["pip install --no-cache-dir -r backend/requirements.txt"]

[phases.build]
cmds = []

[start]
# Gevent async worker - timeout sorunlarını çözer
# workers=1: gevent async olduğu için tek worker yeterli (daha az memory)
# timeout 600s, graceful-timeout 300s - Railway için optimize
cmd = "gunicorn backend.app:app --bind 0.0.0.0:$PORT --worker-class gevent --workers 1 --timeout 600 --graceful-timeout 300 --keepalive 30"
